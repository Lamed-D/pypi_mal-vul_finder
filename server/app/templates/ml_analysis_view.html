<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML 패키지 분석 결과 - PySecure</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    
    <style>
        .analysis-card {
            border-left: 4px solid #007bff;
            margin-bottom: 1rem;
        }
        
        .malicious-card {
            border-left-color: #dc3545;
            background-color: #f8d7da;
        }
        
        .vulnerable-card {
            border-left-color: #ffc107;
            background-color: #fff3cd;
        }
        
        .safe-card {
            border-left-color: #28a745;
            background-color: #d4edda;
        }
        
        .threat-level-high {
            color: #dc3545;
            font-weight: bold;
        }
        
        .threat-level-medium {
            color: #ffc107;
            font-weight: bold;
        }
        
        .threat-level-low {
            color: #28a745;
            font-weight: bold;
        }
        
        
        .package-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .stats-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .filter-buttons {
            margin-bottom: 2rem;
        }
        
        .package-item {
            transition: transform 0.2s ease;
        }
        
        .package-item:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-shield-alt"></i> PySecure
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">
                    <i class="fas fa-home"></i> 대시보드
                </a>
                <a class="nav-link" href="/upload">
                    <i class="fas fa-upload"></i> 파일 업로드
                </a>
            </div>
        </div>
    </nav>

    <!-- Package Header -->
    <div class="package-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2">
                        <i class="fas fa-brain"></i> ML 패키지 분석 결과
                    </h1>
                    <p class="mb-0">LSTM + XGBoost 기반 통합 보안 분석</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="stats-card">
                        <h5 class="mb-1">세션 ID</h5>
                        <code>{{ session_id }}</code>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Summary Statistics -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <h3 class="text-primary">{{ summary.total_packages }}</h3>
                    <p class="mb-0">총 패키지</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <h3 class="text-danger">{{ summary.malicious_packages }}</h3>
                    <p class="mb-0">악성 패키지</p>
                    <small class="text-muted">{{ "%.1f"|format(summary.malicious_rate) }}%</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <h3 class="text-warning">{{ summary.vulnerable_packages }}</h3>
                    <p class="mb-0">취약점 패키지</p>
                    <small class="text-muted">{{ "%.1f"|format(summary.vulnerable_rate) }}%</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <h3 class="text-success">{{ summary.safe_packages }}</h3>
                    <p class="mb-0">안전한 패키지</p>
                    <small class="text-muted">{{ "%.1f"|format(summary.safe_rate) }}%</small>
                </div>
            </div>
        </div>

        <!-- Filter Buttons -->
        <div class="filter-buttons">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary active" onclick="filterPackages('all')">
                    <i class="fas fa-list"></i> 전체 ({{ summary.total_packages }})
                </button>
                <button type="button" class="btn btn-outline-danger" onclick="filterPackages('malicious')">
                    <i class="fas fa-exclamation-triangle"></i> 악성 ({{ summary.malicious_packages }})
                </button>
                <button type="button" class="btn btn-outline-warning" onclick="filterPackages('vulnerable')">
                    <i class="fas fa-bug"></i> 취약점 ({{ summary.vulnerable_packages }})
                </button>
                <button type="button" class="btn btn-outline-success" onclick="filterPackages('safe')">
                    <i class="fas fa-check-circle"></i> 안전 ({{ summary.safe_packages }})
                </button>
            </div>
        </div>

        <!-- Package Results -->
        <div class="row" id="package-results">
            {% for result in results %}
            <div class="col-md-6 col-lg-4 package-item" 
                 data-package-type="{% if result.final_malicious_status %}malicious{% elif result.lstm_vulnerability_status == 'Vulnerable' %}vulnerable{% else %}safe{% endif %}">
                <div class="card analysis-card {% if result.final_malicious_status %}malicious-card{% elif result.lstm_vulnerability_status == 'Vulnerable' %}vulnerable-card{% else %}safe-card{% endif %}">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <i class="fas fa-cube"></i> {{ result.package_name }}
                        </h6>
                        <span class="badge {% if result.final_malicious_status %}bg-danger{% elif result.lstm_vulnerability_status == 'Vulnerable' %}bg-warning{% else %}bg-success{% endif %}">
                            {% if result.final_malicious_status %}
                                <i class="fas fa-exclamation-triangle"></i> 악성
                            {% elif result.lstm_vulnerability_status == 'Vulnerable' %}
                                <i class="fas fa-bug"></i> 취약점
                            {% else %}
                                <i class="fas fa-check-circle"></i> 안전
                            {% endif %}
                        </span>
                    </div>
                    <div class="card-body">
                        <!-- Package Info -->
                        <div class="mb-3">
                            <small class="text-muted">
                                <i class="fas fa-user"></i> {{ result.author or 'Unknown' }}<br>
                                <i class="fas fa-tag"></i> v{{ result.version or 'Unknown' }}<br>
                                <i class="fas fa-download"></i> {{ "{:,}".format(result.download_count) }} downloads
                            </small>
                        </div>

                        <!-- Summary -->
                        {% if result.summary %}
                        <p class="card-text small">{{ result.summary[:100] }}{% if result.summary|length > 100 %}...{% endif %}</p>
                        {% endif %}

                        <!-- LSTM Analysis -->
                        <div class="mb-2">
                            <small class="text-muted">LSTM 분석:</small>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge {% if result.lstm_vulnerability_status == 'Vulnerable' %}bg-warning{% else %}bg-success{% endif %}">
                                    {{ result.lstm_vulnerability_status }}
                                </span>
                            </div>
                            {% if result.lstm_cwe_label and result.lstm_cwe_label != 'Benign' %}
                            <small class="text-muted">CWE: {{ result.lstm_cwe_label }}</small>
                            {% endif %}
                        </div>

                        <!-- XGBoost Analysis -->
                        <div class="mb-2">
                            <small class="text-muted">XGBoost 예측:</small>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge {% if result.xgboost_prediction == 1 %}bg-danger{% else %}bg-success{% endif %}">
                                    {% if result.xgboost_prediction == 1 %}악성{% else %}정상{% endif %}
                                </span>
                            </div>
                        </div>

                        <!-- Threat Level -->
                        <div class="mb-2">
                            <small class="text-muted">위협 수준:</small>
                            <span class="threat-level-{% if result.threat_level == 2 %}high{% elif result.threat_level == 1 %}medium{% else %}low{% endif %}">
                                {% if result.threat_level == 2 %}
                                    <i class="fas fa-exclamation-triangle"></i> 높음
                                {% elif result.threat_level == 1 %}
                                    <i class="fas fa-exclamation-circle"></i> 보통
                                {% else %}
                                    <i class="fas fa-check-circle"></i> 낮음
                                {% endif %}
                            </span>
                        </div>

                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- No Results Message -->
        <div id="no-results" class="text-center py-5" style="display: none;">
            <i class="fas fa-search fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">선택한 조건에 맞는 패키지가 없습니다.</h4>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 PySecure - Python Security Analysis System. All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Prism.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script>
        function filterPackages(type) {
            const packages = document.querySelectorAll('.package-item');
            const noResults = document.getElementById('no-results');
            let visibleCount = 0;

            // Update button states
            document.querySelectorAll('.filter-buttons .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            packages.forEach(package => {
                const packageType = package.getAttribute('data-package-type');
                
                if (type === 'all' || packageType === type) {
                    package.style.display = 'block';
                    visibleCount++;
                } else {
                    package.style.display = 'none';
                }
            });

            // Show/hide no results message
            if (visibleCount === 0) {
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Add smooth scrolling
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

        });
    </script>
</body>
</html>
