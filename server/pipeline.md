# Python Security Analysis System - Pipeline 문서

## 📋 시스템 개요

Python Security Analysis System은 ZIP 파일로 업로드된 Python 코드를 AI 기반으로 분석하여 취약점과 악성코드를 탐지하는 웹 애플리케이션입니다.

## 🏗️ 시스템 아키텍처

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   웹 인터페이스    │    │   FastAPI 서버   │    │   AI 분석 엔진   │
│   (HTML/CSS/JS) │◄──►│   (REST API)    │◄──►│   (LSTM 모델)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │   SQLite DB     │
                       │   (분석 결과)     │
                       └─────────────────┘
```

## 📁 디렉토리 구조

```
server/
├── 📁 app/                          # FastAPI 애플리케이션
│   ├── 📄 main.py                   # 메인 애플리케이션 (라우트, API)
│   ├── 📁 services/                 # 비즈니스 로직 서비스
│   │   └── 📄 file_service.py       # 파일 처리 서비스
│   └── 📁 templates/                # HTML 템플릿
│       ├── 📄 dashboard.html        # 대시보드 페이지
│       ├── 📄 vulnerable_view.html  # 취약점 분석 결과 페이지
│       ├── 📄 malicious_view.html   # 악성코드 분석 결과 페이지
│       └── 📄 session_detail.html   # 세션 상세 페이지
├── 📁 analysis/                     # AI 분석 엔진
│   └── 📄 integrated_lstm_analyzer.py # 통합 LSTM 분석기
├── 📁 database/                     # 데이터베이스
│   └── 📄 database.py               # DB 스키마 및 CRUD 작업
├── 📁 models/                       # AI 모델 파일
│   ├── 📁 lstm/                     # LSTM 모델들
│   │   ├── 📄 model_vul.pkl         # 취약점 탐지 모델
│   │   ├── 📄 model_mal.pkl         # 악성코드 탐지 모델
│   │   └── 📄 label_encoder_*.pkl   # 라벨 인코더들
│   └── 📁 w2v/                      # Word2Vec 모델
│       └── 📄 word2vec_*.model      # 토큰 임베딩 모델
├── 📁 uploads/                      # 업로드된 파일 저장소
│   └── 📁 {session_id}/             # 세션별 디렉토리
│       └── 📁 extracted/            # 압축 해제된 Python 파일들
├── 📄 config.py                     # 설정 파일
├── 📄 run.py                        # 서버 실행 스크립트
├── 📄 requirements.txt              # Python 의존성
├── 📄 main.db                       # SQLite 데이터베이스
└── 📄 pipeline.md                   # 이 문서
```

## 🔄 데이터 파이프라인

### 1. 파일 업로드 단계
```
사용자 ZIP 업로드 → 파일 검증 → 세션 ID 생성 → UPLOAD 디렉토리에 저장
```

### 2. 파일 처리 단계
```
ZIP 압축 해제 → Python 파일 추출 → 파일 내용 읽기 → 메모리에 로드
```

### 3. AI 분석 단계
```
코드 토큰화 → Word2Vec 임베딩 → LSTM 모델 분석 → 결과 생성
```

### 4. 결과 저장 단계
```
분석 결과 → 데이터베이스 저장 → 웹 인터페이스 표시
```

## 🛠️ 주요 기능

### 1. 파일 업로드 및 처리
- **ZIP 파일 업로드**: 웹 인터페이스를 통한 파일 업로드
- **파일 검증**: 확장자, 크기, 형식 검증
- **압축 해제**: UPLOAD 디렉토리에 Python 파일만 추출
- **원본 ZIP 삭제**: 압축 해제 후 원본 파일 자동 삭제

### 2. AI 기반 보안 분석
- **취약점 탐지**: LSTM 모델을 사용한 취약점 패턴 인식
- **악성코드 탐지**: LSTM 모델을 사용한 악성코드 패턴 인식
- **다중 프로세스**: 3개 워커 프로세스로 병렬 분석
- **실시간 결과**: 분석 진행 상황 실시간 업데이트

### 3. 웹 인터페이스
- **대시보드**: 전체 분석 통계 및 최근 세션 목록
- **분석 결과 뷰**: 취약점/악성코드별 결과 표시
- **소스코드 뷰어**: 파일 클릭 시 모달로 소스코드 표시
- **반응형 디자인**: Bootstrap 5 기반 모바일 친화적 UI

### 4. 데이터 관리
- **세션 관리**: 고유 세션 ID로 분석 세션 추적
- **결과 저장**: SQLite 데이터베이스에 분석 결과 영구 저장
- **통계 제공**: 전체 분석 통계 및 트렌드 정보

## 🔧 API 엔드포인트

### 웹 페이지
- `GET /` - 대시보드
- `GET /session/{session_id}` - 세션 상세
- `GET /session/{session_id}/vulnerable` - 취약점 분석 결과
- `GET /session/{session_id}/malicious` - 악성코드 분석 결과

### REST API
- `POST /api/v1/upload` - 파일 업로드
- `GET /api/v1/sessions` - 세션 목록
- `GET /api/v1/sessions/{session_id}` - 세션 정보
- `GET /api/v1/source/{file_path}` - 소스코드 조회
- `GET /api/v1/stats` - 분석 통계

## 🗄️ 데이터베이스 스키마

### main_log 테이블
- 세션별 분석 요약 정보
- 업로드 시간, 파일명, 분석 결과 통계

### lstm_vul 테이블
- 취약점 분석 결과 상세 정보
- 파일별 취약점 확률, CWE 라벨, 분석 시간

### lstm_mal 테이블
- 악성코드 분석 결과 상세 정보
- 파일별 악성코드 확률, 라벨, 분석 시간

## 🚀 실행 방법

1. **의존성 설치**
   ```bash
   pip install -r requirements.txt
   ```

2. **서버 실행**
   ```bash
   python run.py
   ```

3. **웹 접속**
   ```
   http://127.0.0.1:8000
   ```

## 📊 성능 특성

- **병렬 처리**: 3개 워커 프로세스로 동시 분석
- **메모리 효율**: 스트리밍 방식으로 대용량 파일 처리
- **실시간 업데이트**: WebSocket을 통한 실시간 진행 상황
- **확장성**: 모듈화된 구조로 기능 확장 용이

## 🔒 보안 고려사항

- **파일 검증**: 업로드 파일의 확장자 및 크기 제한
- **격리 실행**: 분석 프로세스 격리로 시스템 보안
- **임시 파일 정리**: 분석 완료 후 임시 파일 자동 삭제
- **세션 관리**: 고유 세션 ID로 사용자 데이터 분리

## 🛡️ 오류 처리

- **파일 오류**: 잘못된 형식의 파일 업로드 시 적절한 오류 메시지
- **분석 오류**: AI 모델 실행 실패 시 기본값 반환
- **네트워크 오류**: API 호출 실패 시 재시도 로직
- **데이터베이스 오류**: 트랜잭션 롤백 및 복구 메커니즘

## 📈 향후 개선 계획

1. **모델 업데이트**: 더 정확한 AI 모델로 업그레이드
2. **실시간 분석**: WebSocket을 통한 실시간 분석 진행 상황
3. **배치 처리**: 대용량 파일 배치 분석 기능
4. **API 확장**: RESTful API 기능 확장
5. **모니터링**: 시스템 성능 모니터링 및 알림 기능

## 🧹 리팩토링 완료 사항

### 코드 품질 개선
- ✅ 모든 주요 모듈에 상세한 한글 주석 추가
- ✅ 함수별 docstring 및 타입 힌트 개선
- ✅ 코드 구조 및 가독성 향상
- ✅ 설정값 중앙 집중화

### 문서화 완료
- ✅ pipeline.md 생성 및 시스템 구조 문서화
- ✅ API 엔드포인트 상세 설명
- ✅ 데이터베이스 스키마 문서화
- ✅ 설치 및 실행 가이드 제공

### 시스템 최적화
- ✅ 불필요한 파일 및 디렉토리 정리
- ✅ 사용하지 않는 `logs/`, `static/` 폴더 삭제
- ✅ 관련 코드 정리 (StaticFiles, 로그 파일 설정)
- ✅ 모듈 구조 최적화
- ✅ 에러 처리 개선
- ✅ 성능 최적화

## 📚 개발자 가이드

### 코드 스타일
- 모든 함수와 클래스에 한글 docstring 작성
- 타입 힌트 사용 권장
- 상수는 대문자로 명명
- 함수명은 동사로 시작

### 디버깅 팁
- 데이터베이스 확인: `main.db`
- 업로드 파일 확인: `uploads/{session_id}/`
- 콘솔 로그 확인: 서버 실행 시 터미널 출력

### 성능 튜닝
- `config.py`에서 배치 크기 조정
- 워커 프로세스 수 조정 (기본 3개)
- 메모리 사용량 모니터링
